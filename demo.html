<!DOCTYPE html>
<html>
<head>
   <meta charset="utf-8">
   <style>
      .circle-progress {
         width: 100%;
         height: 100%;
         position: relative;
         overflow: hidden;
      }
      .circle-progress > div {
         position: relative;
         width: 100%;
         height: 100%;
         overflow: hidden;
         box-sizing: border-box;
         padding: 2px;
      }
      .circle-progress > div > div {
         box-sizing: border-box;
         width: 100%;
         height: 100%;
         border-width: 30px;
         border-style: solid;
         border-color: #fff;
         border-radius: 50%;
         position: absolute;
         top: 0;
         left: 0;
         text-align: center;
      }
      .circle-progress .left {
         clip: rect(0 100px 200px 0);
         border-color: #4b86db;
         opacity: 0;
         transform: rotate(180deg);
         transition: transform 0.6s linear;
      }
      .circle-progress .right {
         clip: rect(0 200px 200px 100px);
         border-color: #4b86db;
         opacity: 0;
         transform: rotate(-180deg);
         transition: transform 0.6s linear;
      }
      .circle-progress .left-back {
         clip: rect(0 100px 200px 0);
      }
      .circle-progress .right-back {
         clip: rect(0 200px 200px 100px);
      }
      .circle-progress .text {
         font-size: 2rem;
         line-height: 2rem;
         position: absolute;
         top: 40%;
         font-family: Arial, Helvetica, Sans-Serif;
         text-align: center;
      }
      
      .circle-progress {
         width: 100px;
         height: 100px;
      }
   </style>
   <script>
      
      window['$circle_loader'] = function(el, col, backcol) {
      
         el.innerHTML = '<div class="circle-progress"><div><div class="left"></div><div class="right"></div><div class="left-back"></div><div class="right-back"></div></div><div class="text">0</div></div>'
         el = el.children[0]
         
         var left = el.querySelector('.left')
         var right = el.querySelector('.right')
         
         var left_back = el.querySelector('.left-back')
         var right_back = el.querySelector('.right-back')
         
         if (!backcol) {
            var st = left_back.currentStyle || getComputedStyle(left_back, '')
            backcol = st.backgroundColor
            if (backcol.replace(/\s/g, '') == 'rgba(0,0,0,0)') {
               backcol = 'transparent'
            }
         }
         
         right.style.opacity = '0'
         
         el.style.display = 'block'
         var w = el.clientWidth
         
         if (backcol == 'transparent') {
            el.children[0].style.width = (w / 2) + 'px'
            el.children[0].style.left = (w / 2) + 'px'
         } else {
            left_back.style.zIndex = '1'
            left.style.zIndex = ''
            right.style.zIndex = '1'
            right_back.style.zIndex = ''
            left_back.style.opacity = '1'
            right_back.style.opacity = '1'
         }
         
         for (var i = 0; i < el.children[0].children.length; i++) {
            if (backcol == 'transparent') {
               el.children[0].children[i].style.width = w + 'px'
               el.children[0].children[i].style.marginLeft = -(w / 2) + 'px'
            }
            el.children[0].children[i].style.borderWidth = 0.15 * w + 'px'
         }
         left.style.clip = 
         left_back.style.clip = 'rect(0 ' + (w/2) + 'px ' + w + 'px 0)'
         right.style.clip = 
         right_back.style.clip = 'rect(0 ' + w + 'px ' + w + 'px ' + (w/2) + 'px)'
         el.style.display = 'none'
            
         var text = el.querySelector('.text')
         if (text) {
            text.style.fontSize = text.style.lineHeight = w * 0.2 + 'px'
         }
         
         return {
            el: el,
            val: 0,
            backcol: backcol,
            update: function(progress) {
               progress = Math.max(0, Math.min(1, progress))
               this.val = progress
               
               var text = this.el.querySelector('.text')
               if (text) {
                  text.textContent = Math.min(Math.round(progress * 100), 100)
               }
               
               var left = this.el.querySelector('.left')
               var right = this.el.querySelector('.right')
               
               if (progress <= 0.5) {
                  if (this.el.children[0].style.width == '') {
                     var w = this.el.clientWidth
                     
                     if (this.backcol == 'transparent') {
                        this.el.children[0].style.width = (w / 2) + 'px'
                        this.el.children[0].style.left = (w / 2) + 'px'
                        
                        for (var i = 0; i < this.el.children[0].children.length; i++) {
                           this.el.children[0].children[i].style.width = w + 'px'
                           this.el.children[0].children[i].style.marginLeft = -(w / 2) + 'px'
                        }
                     } else {
                        left_back.style.zIndex = '1'
                        right_back.style.zIndex = ''
                        left_back.style.opacity = '1'
                        right_back.style.opacity = '1'
                     }
                     
                  } else {
                     left_back.style.zIndex = '1'
                     left.style.zIndex = ''
                     right.style.zIndex = '1'
                     right_back.style.zIndex = ''
                     left_back.style.opacity = '1'
                     right_back.style.opacity = '1'
                  }
                  
                  var deg = -180 + 360 * progress
                  left.style.opacity = '0'
                  left.style.transform = 'rotate(180deg)'
                  
                  right.style.opacity = '1'
                  right.style.transform = 'rotate(' + deg + 'deg)'
               } else {
                  if (this.el.children[0].style.width != '' && backcol == 'transparent') {
                     this.el.children[0].style.width = ''
                     this.el.children[0].style.left = ''
                     for (var i = 0; i < this.el.children[0].children.length; i++) {
                        this.el.children[0].children[i].style.width = ''
                        this.el.children[0].children[i].style.marginLeft = ''
                     }
                     left_back.style.zIndex = '-1'
                  } else if (backcol != 'transparent') {
                     left_back.style.zIndex = '0'
                     left.style.zIndex = '1'
                     right.style.zIndex = '1'
                     right_back.style.zIndex = ''
                     left_back.style.opacity = '1'
                     right_back.style.opacity = '1'
                  }
                  
                  right.style.opacity = '1'
                  right.style.transform = 'rotate(0deg)'
               
                  var deg = 180 + 360 * (progress - 0.5)
                  
                  left.style.opacity = '1'
                  left.style.transform = 'rotate(' + deg + 'deg)'
               }
               return this
            },
            show: function() {
               this.el.style.display = ''
               this.el.style.visibility = 'visible'
               this.el.style.opacity = '1'
               return this
            },
            hide: function() {
               this.el.style.opacity = '0'
               var el = this.el
               setTimeout(function() {
                  el.style.display = 'none'
               }, 1000)
               return this
            }, 
            reset: function() {
               this.update(0)
               return this
            }
         }
      }
   
      window.onload = function() {
         window.progress = $circle_loader(document.querySelector('.circle-progress-wrap'), null, null)
         window.progress.show()
      }
      
      function increment() {
         window.progress.update(window.progress.val + 0.1)
      }
      
      function decrement() {
         window.progress.update(window.progress.val - 0.1)
      }
   
   </script>
</head>

<body>
   <div style="width: 160px">
      <div style="width: 120px; margin: 4px auto">
         <div class="circle-progress-wrap"></div>
      </div>
      <div style="box-sizing: border-box; width: 100%; min-width: 160px; padding: 10px; text-align: center"><button onclick="decrement()">-10%</button> <button onclick="increment()">+10%</button></div>
   </div>
</body>
</html>
